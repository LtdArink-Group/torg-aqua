# KSAZD2AQUa

Интеграция ИС КСАЗД и ИС АКВа

## Общие положения

Внешний интерфейс системы доступен по адресу http://ksazd-aqua.rao-esv.ru

Синхронизация данных по проектам производится ежесуточно в 07:30. Синхронизация данных по лотам производится каждые 10 минут.

## Установка и настройка

### Требования к окружению

Для установки модуля интеграции требуется наличие интерпретатора языка Ruby версии 2.1.0 или выше.

### Установка

Установка производится в директорию `/home/deployer/apps/ksazd2aqua`. Если будет использована другая директория то нужно изменить пути в файлах `config/ksazd2aqua.sh`, `config/nginx.conf`.

Установка приложения производится в директории приложения командами
``` sh
$ git clone git@github.com:kodram/ksazd2aqua.git .
$ bundle
```

### Настройка

Для настроки параметров системы нужно скопировать файл `config/configuration.example.yml` в `config/configuration.yml` и произвести настройку параметров системы. Если на сервере не используется proxy для доступа к веб-ресурсам, то нужно удалить параметр `soap.proxy` в конфигурационном файле.

Инициализация базы данных и заполнение данными справочников производится командой
``` shell
$ bundle exec rake db:setup
```

Настройка cron-задач для загрузки проектов и передачи лотов производится командой
``` shell
$ bundle exec whenever -w
```

Проверить результат выполнения можно запуском команды `crontab -l`

Перед запуском веб-сервера необходимо создать символьные ссылки на файлы конфигурации nginx и скрипт запуска веб-сервера
``` shell
$ ln -nfs config/nginx.conf /etc/nginx/sites-available/ksazd2aqua
$ ln -nfs config/ksazd2aqua.sh /etc/init.d/thin-ksazd2aqua
```

Запуск веб-сервера производится командой
```
$ bin/start
```

### Обновление

Для обновления системы следует перейти в директорию системы и зпустить команды
``` sh
$ git pull
$ bin/restart
```

## Эксплуатация сиситемы

Для мониторинга состояния системы можно пользоваться веб-интерфейсом. Более подробная информация о работе системы находится в логах в директории `logs`.

### Типичные ошибки и их устранение

